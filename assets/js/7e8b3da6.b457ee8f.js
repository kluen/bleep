"use strict";(self.webpackChunkbleep_site=self.webpackChunkbleep_site||[]).push([[723],{3905:(e,t,r)=>{r.d(t,{Zo:()=>d,kt:()=>m});var n=r(7294);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var l=n.createContext({}),u=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},d=function(e){var t=u(e.components);return n.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var r=e.components,i=e.mdxType,a=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=u(r),m=i,b=p["".concat(l,".").concat(m)]||p[m]||c[m]||a;return r?n.createElement(b,o(o({ref:t},d),{},{components:r})):n.createElement(b,o({ref:t},d))}));function m(e,t){var r=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=r.length,o=new Array(a);o[0]=p;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var u=2;u<a;u++)o[u]=r[u];return n.createElement.apply(null,o)}return n.createElement.apply(null,r)}p.displayName="MDXCreateElement"},817:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>a,metadata:()=>s,toc:()=>u});var n=r(7462),i=(r(7294),r(3905));const a={},o="Build rewrites",s={unversionedId:"usage/build-rewrites",id:"usage/build-rewrites",title:"Build rewrites",description:"The build itself is completely declarative, and that is enough for very, very many cases. For the few cases where you need more powers we have Build Rewrites.",source:"@site/docs/usage/build-rewrites.mdx",sourceDirName:"usage",slug:"/usage/build-rewrites",permalink:"/docs/usage/build-rewrites",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Installing tab completions",permalink:"/docs/usage/tab-completions"},next:{title:"Porting sbt plugins!",permalink:"/docs/porting-sbt-plugins"}},l={},u=[{value:"Using rewritten builds in a script",id:"using-rewritten-builds-in-a-script",level:2},{value:"Persisting rewritten builds",id:"persisting-rewritten-builds",level:2}],d={toc:u};function c(e){let{components:t,...r}=e;return(0,i.kt)("wrapper",(0,n.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"build-rewrites"},"Build rewrites"),(0,i.kt)("p",null,"The build itself is completely declarative, and that is enough for very, very many cases. For the few cases where you need more powers we have Build Rewrites."),(0,i.kt)("p",null,"A build rewrite can be used in a script to boot a variant of the build which is transformed in some arbitrary manner."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-scala"},"trait BuildRewrite {\n  val name: BuildRewriteName\n\n  def newExplodedProjects(oldBuild: model.Build): Map[model.CrossProjectName, model.Project]\n\n}\n")),(0,i.kt)("p",null,"Basically it takes a fully parsed and expanded build, and lets you take the complete set of projects and rewrite them to whatever you want."),(0,i.kt)("p",null,"For instance this build rewrite adds a scala compiler flag to all projects:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-scala"},'object AddDummyFlag extends BuildRewrite {\n      override val name = model.BuildRewriteName("add-dummy-flag")\n\n      override protected def newExplodedProjects(oldBuild: model.Build): Map[model.CrossProjectName, model.Project] =\n        oldBuild.explodedProjects.map { case (crossName, p) =>\n          (crossName, p.copy(scala = p.scala.map(s => s.copy(options = s.options union model.Options.parse(List("-foo"), None)))))\n        }\n    }\n')),(0,i.kt)("h2",{id:"using-rewritten-builds-in-a-script"},"Using rewritten builds in a script"),(0,i.kt)("p",null,"You can write a script which uses this rewrite like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-scala"},'object GenDocumentation extends BleepScript("GenDocumentation") {\n  override val rewrites: List[BuildRewrite] = List(AddDummyFlag)\n    def run(started: Started, commands: Commands, args: List[String]): Unit = ???\n}\n')),(0,i.kt)("p",null,"Bleep considers a build which is booted with rewrites completely separate from the normal build, you can see it in the ",(0,i.kt)("inlineCode",{parentName:"p"},".bleep")," directory."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},".bleep/builds/normal # the build you're working with from the command line\n.bleep/builds/bsp # the build you're working with from IDE. This has semanticdb and a subset of all projects\n.bleep/builds/add-dummy-flag # a name derived by appending names of all applied build rewrites\n")),(0,i.kt)("p",null,"So this is the foundation you can use to for instance add jmh flags and run benchmarking scripts. You can add Scala.js ",(0,i.kt)("inlineCode",{parentName:"p"},"mapSourceURI")," with a reference to a given git SHA you have found. Or pretty much anything else.\nYou can of course also publish and/or package your app based on one of these builds."),(0,i.kt)("h2",{id:"persisting-rewritten-builds"},"Persisting rewritten builds"),(0,i.kt)("p",null,"You can also write these rewritten builds back to the build file.\nAs such you have for instance the infrastructure to write a script which\n1) checks out all bleep repositories in your organisation\n2) applies patches. Think for instance dependency updates\n3) pushes all the changes back into pull requests"))}c.isMDXComponent=!0}}]);